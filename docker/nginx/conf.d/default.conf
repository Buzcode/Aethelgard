# docker/nginx/conf.d/default.conf

server {
    listen 80;
    server_name localhost;

    # The root directory for your frontend's static files.
    root /usr/share/nginx/html;
    index index.html;

    # Rule 1: Handle Frontend Application Routes
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Rule 2: Handle Backend API calls
    location /api {
        rewrite ^/api/(.*)$ /$1 break;
        
        fastcgi_pass app:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME /var/www/public/index.php;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    # --- THIS IS THE CORRECTED BLOCK ---
    # Rule 3: Handle requests for uploaded files in /storage
    # Instead of using 'alias', we pass the request to PHP-FPM.
    # Laravel is smart enough to find and serve the static file from its
    # public directory (via the symbolic link you created).
    location /storage {
        alias /var/www/storage/app/public;
        try_files $uri =404;
    }
}