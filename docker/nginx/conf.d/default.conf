
# docker/nginx/conf.d/default.conf

server {
    listen 80;
    server_name localhost;

    # The root directory is now where your frontend's static files are.
    root /usr/share/nginx/html;
    index index.html;

    # Rule 1: Handle Frontend Application Routes
    # This serves the index.html for any route that isn't a static file,
    # allowing your frontend router (e.g., Vue Router, React Router) to work.
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Rule 2: Handle Backend API calls
    # Any request starting with /api/ will be forwarded to the Laravel backend.
    location /api {
        # This removes the '/api' prefix before sending to PHP-FPM,
        # so Laravel sees '/users' instead of '/api/users'.
        # If your Laravel routes already include '/api', you can remove this line.
        rewrite ^/api/(.*)$ /$1 break;
        
        # Pass the request to the PHP-FPM service named 'app' on port 9000.
        fastcgi_pass app:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME /var/www/public/index.php;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    # Optional: If you need to access Laravel's storage files directly, keep this.
    # For example, for images uploaded by users.
    location /storage {
         alias /var/www/public/storage;
         try_files $uri =404;
    }
}